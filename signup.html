<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>

    <!-- Firebase SDKs -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBZU3oUaCNjMVVTTwXBqaUH0XYY5M9K7z0",
        authDomain: "avalis-9c595.firebaseapp.com",
        projectId: "avalis-9c595",
        storageBucket: "avalis-9c595.firebasestorage.app",
        messagingSenderId: "1014604630131",
        appId: "1:1014604630131:web:b4b9fc13163834ff7d4206",
        measurementId: "G-Q7D9PP4KFH"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);

      function signupUser(event) {
        event.preventDefault();
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        const role = document.getElementById("role").value || 'player'; // Default role is 'player'

        createUserWithEmailAndPassword(auth, username, password)
          .then((userCredential) => {
            const user = userCredential.user;
            
            // Save user data with selected role
            set(ref(database, 'users/' + user.uid), {
              username: username,
              role: role
            }).then(() => {
              alert("Signup successful! You are now registered as " + role);
              window.location.href = "login.html";
            });
          })
          .catch((error) => {
            alert(error.message);
          });
      }
    </script>
</head>
<body>
    <!-- Header -->
    <div id="header-container"></div>

    <h2>Sign Up</h2>
    <form id="signup-form" onsubmit="signupUser(event)">
        <label for="username">Username:</label>
        <input type="text" id="username" required>

        <label for="password">Password:</label>
        <input type="password" id="password" required>

        <label for="role">Choose Role:</label>
        <select id="role">
            <option value="player" selected>Player</option>
            <option value="dungeon-master">Dungeon Master</option>
        </select>

        <button type="submit">Sign Up</button>
    </form>

    <script>
        // Load the header dynamically
        fetch("header.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("header-container").innerHTML = data;
            });
    </script>
</body>
</html>
